@startuml
set separator none
title Hybrid Bichard

top to bottom direction

!include <C4/C4>
!include <C4/C4_Context>
!include <C4/C4_Container>

Person(PoliceUser, "Police User", $descr="", $tags="", $link="")
System(CJSM, "CJSM", $descr="", $tags="", $link="")
System(PSNProxy, "PSN Proxy", $descr="Q-Solution", $tags="", $link="")
System(ExISS, "ExISS", $descr="", $tags="", $link="")

System_Boundary("Bichard_boundary", "Bichard", $tags="") {
  Container(Bichard.DynamoDB, "DynamoDB", $techn="", $descr="", $tags="", $link="")
  Container(Bichard.MessageTransferLambda, "Message Transfer Lambda", $techn="", $descr="", $tags="", $link="")
  Container(Bichard.NginxAuthProxy, "Nginx Auth Proxy", $techn="Nginx", $descr="", $tags="", $link="")
  ContainerDb(Bichard.BichardDatabase, "Bichard Database", $techn="PostgreSQL", $descr="", $tags="", $link="")
  Container(Bichard.EmailSystem, "Email System", $techn="Postfix", $descr="", $tags="", $link="")
  Container(Bichard.BichardJavaApplication, "Bichard Java Application", $techn="Java EE", $descr="", $tags="", $link="")
  Container(Bichard.BichardUserService, "Bichard User Service", $techn="Next.js, TypeScript & React", $descr="An application to provide user authentication and user management", $tags="", $link="")
  Container(Bichard.AuditLog, "Audit Log", $techn="", $descr="", $tags="", $link="")
  Container(Bichard.StaticFileService, "Static File Service", $techn="", $descr="", $tags="", $link="")
  Container(Bichard.Reporting, "Reporting", $techn="", $descr="", $tags="", $link="")
  Container(Bichard.Monitoring, "Monitoring", $techn="", $descr="", $tags="", $link="")
  Container(Bichard.PNCAPI, "PNC API", $techn="", $descr="", $tags="", $link="")
  Container(Bichard.BichardUI, "Bichard UI", $techn="TypeScript & React", $descr="A new way of interacting with Bichard, complying with Gov.uk standards", $tags="", $link="")
  Container(Bichard.Conductor, "Conductor", $techn="", $descr="", $tags="", $link="")
  Container(Bichard.BichardAPI, "Bichard API", $techn="TypeScript, Fastify & Zod", $descr="An API to remove DB actions from UI and to be Audit Logs", $tags="", $link="")
}

Rel(Bichard.Reporting, Bichard.AuditLog, "", $techn="", $tags="", $link="")
Rel(Bichard.Reporting, Bichard.StaticFileService, "", $techn="", $tags="", $link="")
Rel(Bichard.Reporting, Bichard.EmailSystem, "", $techn="", $tags="", $link="")
Rel(Bichard.Reporting, Bichard.BichardDatabase, "", $techn="", $tags="", $link="")
Rel(Bichard.NginxAuthProxy, Bichard.BichardUI, "", $techn="", $tags="", $link="")
Rel(Bichard.BichardUI, Bichard.BichardDatabase, "", $techn="", $tags="", $link="")
Rel(Bichard.BichardUI, Bichard.BichardAPI, "", $techn="", $tags="", $link="")
Rel(Bichard.BichardUI, Bichard.AuditLog, "", $techn="", $tags="", $link="")
Rel(Bichard.BichardAPI, Bichard.DynamoDB, "", $techn="", $tags="", $link="")
Rel(Bichard.PNCAPI, PSNProxy, "", $techn="", $tags="", $link="")
Rel(Bichard.Conductor, Bichard.BichardDatabase, "", $techn="", $tags="", $link="")
Rel(Bichard.MessageTransferLambda, Bichard.Conductor, "", $techn="", $tags="", $link="")
Rel(Bichard.Conductor, Bichard.AuditLog, "", $techn="", $tags="", $link="")
Rel(Bichard.Conductor, Bichard.PNCAPI, "", $techn="", $tags="", $link="")
Rel(PoliceUser, Bichard.NginxAuthProxy, "Uses", $techn="", $tags="", $link="")
Rel(CJSM, PoliceUser, "Gets email", $techn="", $tags="", $link="")
Rel(Bichard.EmailSystem, CJSM, "Sends verification code", $techn="", $tags="", $link="")
Rel(Bichard.BichardUserService, Bichard.EmailSystem, "Sends verification code", $techn="", $tags="", $link="")
Rel(Bichard.NginxAuthProxy, Bichard.BichardJavaApplication, "", $techn="", $tags="", $link="")
Rel(Bichard.NginxAuthProxy, Bichard.BichardUserService, "Uses", $techn="", $tags="", $link="")
Rel(Bichard.NginxAuthProxy, Bichard.StaticFileService, "", $techn="", $tags="", $link="")
Rel(Bichard.BichardUserService, Bichard.BichardDatabase, "Reads from / Writes to", $techn="", $tags="", $link="")
Rel(Bichard.BichardJavaApplication, Bichard.BichardDatabase, "Reads from / Writes to", $techn="", $tags="", $link="")
Rel(Bichard.BichardAPI, Bichard.BichardDatabase, "Reads from / Writes to", $techn="", $tags="", $link="")
Rel(ExISS, Bichard.MessageTransferLambda, "", $techn="", $tags="", $link="")
Rel(Bichard.AuditLog, Bichard.DynamoDB, "", $techn="", $tags="", $link="")

SHOW_LEGEND(true)
@enduml